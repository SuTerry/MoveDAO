{"version":3,"file":"js/src_views_Detail_index_tsx.a3602871.js","mappings":"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","sources":["webpack://react/./node_modules/.pnpm/registry.npmmirror.com+core-js@3.25.1/node_modules/core-js/modules/es.array.map.js","webpack://react/./src/views/Detail/index.tsx"],"sourcesContent":["'use strict';\nvar $ = require('../internals/export');\nvar $map = require('../internals/array-iteration').map;\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('map');\n\n// `Array.prototype.map` method\n// https://tc39.es/ecma262/#sec-array.prototype.map\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT }, {\n  map: function map(callbackfn /* , thisArg */) {\n    return $map(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","import React, { useEffect, useState } from 'react'\r\n\r\nimport { Button } from '@mui/material'\r\n\r\nimport { useNavigate, useParams } from 'react-router-dom'\r\n\r\nimport dayjs from 'dayjs'\r\n\r\nimport { WalletButton } from '@components/WalletButton'\r\n\r\nimport message from '@components/Message'\r\n\r\nimport { proposalsApi } from '@api/index'\r\n\r\nimport { ProsposalResponse, VotesDetail } from '@api/proposals'\r\n\r\nimport { useAppSelector } from '@store/index'\r\n\r\nimport { truncateMiddle, percentage } from '@utils/index'\r\n\r\nimport './index.less'\r\n\r\nenum ShouldPass {\r\n  '支持'= 1,\r\n  '反对' = 2,\r\n  '弃权' = 3,\r\n}\r\n\r\nexport default (): JSX.Element => {\r\n\r\n  const [proposals, setProposals] = useState<ProsposalResponse>()\r\n\r\n  const [voteDetail, setVoteDetail] = useState<VotesDetail[]>([])\r\n\r\n  const [voteDisabled, setVoteDisabled] = useState(true)\r\n\r\n  const { accountAddress } = useAppSelector(state => state.wallet)\r\n\r\n  const [total, setTotal] = useState(0)\r\n\r\n  const navigate = useNavigate()\r\n\r\n  const { id = '', handle = '' } = useParams()\r\n\r\n  const getDetailData = async () => {\r\n    try {\r\n      const [prosposalRes, votesRes] = await Promise.all([proposalsApi.getProsposal(id, handle), proposalsApi.getTableVotes(id)])\r\n      setProposals(prosposalRes)\r\n      setVoteDetail(votesRes)\r\n      setVoteDisabled(!accountAddress || !!votesRes.find(vote => vote.proposer === accountAddress))\r\n    } catch (error) {\r\n\r\n    }\r\n  }\r\n\r\n  const handleVote = (type: number): void => {\r\n    setVoteDisabled(true)\r\n    proposalsApi.vote([parseInt(id), 1, type]).then(() => {\r\n      message.success('投票成功')\r\n      getDetailData()\r\n    }).catch(() => {\r\n      setVoteDisabled(false)\r\n    })\r\n  }\r\n\r\n  useEffect(() => {\r\n    getDetailData()\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (proposals) setTotal(parseInt(proposals.yes_votes) + parseInt(proposals.no_votes) + parseInt(proposals.abstained_votes))\r\n  }, [proposals])\r\n\r\n  return (\r\n    <div className='detail'>\r\n      <div className=\"detail_back\">\r\n        <Button\r\n          variant=\"contained\"\r\n          sx={{\r\n            width: 100,\r\n          }}\r\n          onClick={() => navigate('/list')}>\r\n          返回\r\n        </Button>\r\n      </div>\r\n\r\n      {\r\n        proposals && (\r\n          <div className=\"detail_container\">\r\n            <div className=\"detail_container_top\">\r\n              <div className=\"d_c_t_left\">\r\n                <div className=\"d_c_t_l_title\">{proposals.title}</div>\r\n                <div className=\"d_c_t_l_sub_title\">\r\n                  <div className=\"d_c_t_l_s_resolved\">{proposals.is_resolved ? '已结束' : '进行中'}</div>\r\n                  <div className=\"d_c_t_l_s_proposer\">{truncateMiddle(proposals.proposer, 3, 3)} 发起</div>\r\n                </div>\r\n                <div className=\"d_c_t_l_description\">\r\n                  <div className=\"d_c_t_l_d_title\">提案内容</div>\r\n                  <div className=\"d_c_t_l_d_content\">\r\n                    <div className=\"d_c_t_l_d_c_html\" dangerouslySetInnerHTML={{ __html: proposals.description }}></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"d_c_t_right\">\r\n                <div className=\"d_v_t_r_date\">\r\n                  <div className=\"d_v_t_r_d_left\">\r\n                    <div className=\"d_v_t_r_d_l_title\">开始投票日期</div>\r\n                    <div className=\"d_v_t_r_d_l_date\">{dayjs(parseInt(proposals.start_time)).format('MM/DD/YYYY')}</div>\r\n                  </div>\r\n                  <div className=\"d_v_t_r_d_right\">\r\n                    <div className=\"d_v_t_r_d_r_title\">结束投票日期</div>\r\n                    <div className=\"d_v_t_r_d_r_date\">{dayjs(parseInt(proposals.end_time)).format('MM/DD/YYYY')}</div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"d_v_t_r_bottom\">\r\n                  <div className=\"d_v_t_r_b_title\">投票结果</div>\r\n                  <div className=\"d_v_t_r_b_votes\">\r\n                    <div className=\"d_v_t_r_b_v_title\">\r\n                      <div className=\"d_v_t_r_b_v_t_left\">支持</div>\r\n                      <div className=\"d_v_t_r_b_v_t_left\">{`${proposals.yes_votes}积分 ${percentage(parseInt(proposals.yes_votes), total)}%`}</div>\r\n                    </div>\r\n                    <div className=\"d_v_t_r_b_v_slider\">\r\n                      <div className=\"d_v_t_r_b_v_s_cover\" style={{ width: `${percentage(parseInt(proposals.yes_votes), total)}%` }}></div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"d_v_t_r_b_votes\">\r\n                    <div className=\"d_v_t_r_b_v_title\">\r\n                      <div className=\"d_v_t_r_b_v_t_left\">反对</div>\r\n                      <div className=\"d_v_t_r_b_v_t_left\">{`${proposals.no_votes}积分 ${percentage(parseInt(proposals.no_votes), total)}%`}</div>\r\n                    </div>\r\n                    <div className=\"d_v_t_r_b_v_slider\">\r\n                      <div className=\"d_v_t_r_b_v_s_cover\" style={{ width: `${percentage(parseInt(proposals.no_votes), total)}%` }}></div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"d_v_t_r_b_votes\">\r\n                    <div className=\"d_v_t_r_b_v_title\">\r\n                      <div className=\"d_v_t_r_b_v_t_left\">弃权</div>\r\n                      <div className=\"d_v_t_r_b_v_t_left\">{`${proposals.abstained_votes}积分 ${percentage(parseInt(proposals.abstained_votes), total)}%`}</div>\r\n                    </div>\r\n                    <div className=\"d_v_t_r_b_v_slider\">\r\n                      <div className=\"d_v_t_r_b_v_s_cover\" style={{ width: `${percentage(parseInt(proposals.abstained_votes), total)}%` }}></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"detail_container_bottom\">\r\n              <div className=\"d_c_b_left\">\r\n                <div className=\"d_c_b_l_title\">投票详情</div>\r\n                <ul className=\"d_c_b_l_content\">\r\n                  {\r\n                    voteDetail.map((item, index) => {\r\n                      return (\r\n                        <li className=\"d_c_b_l_c_li\" key={index}>\r\n                          <span className=\"d_c_b_l_c_l_address\">{truncateMiddle(item.proposer, 3, 3)}</span>\r\n                          <span className=\"d_c_b_l_c_l_pass\">{ShouldPass[item.should_pass]}</span>\r\n                          <span className=\"d_c_b_l_c_l_num\">1积分</span>\r\n                        </li>\r\n                      )\r\n                    })\r\n                  }\r\n                </ul>\r\n              </div>\r\n              <div className=\"d_c_b_right\">\r\n                <div className=\"d_c_b_r_title\">投票</div>\r\n                <div className=\"d_c_b_r_bottons\">\r\n                  <WalletButton\r\n                    variant=\"contained\"\r\n                    disabled={voteDisabled}\r\n                    text=\"支持\"\r\n                    sx={{\r\n                      width: 100,\r\n                    }}\r\n                    onClick={() => handleVote(ShouldPass['支持'])}>\r\n                    支持\r\n                  </WalletButton>\r\n                  <WalletButton\r\n                    variant=\"contained\"\r\n                    disabled={voteDisabled}\r\n                    text=\"反对\"\r\n                    sx={{\r\n                      width: 100,\r\n                    }}\r\n                    onClick={() => handleVote(ShouldPass['反对'])}>\r\n                    反对\r\n                  </WalletButton>\r\n                  <WalletButton\r\n                    variant=\"contained\"\r\n                    disabled={voteDisabled}\r\n                    sx={{\r\n                      width: 100,\r\n                    }}\r\n                    text=\"弃权\"\r\n                    onClick={() => handleVote(ShouldPass['弃权'])}>\r\n                    弃权\r\n                  </WalletButton>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )\r\n      }\r\n    </div>\r\n  )\r\n}\r\n"],"names":["$","require","$map","target","proto","forced","arrayMethodHasSpeciesSupport","map","callbackfn","this","arguments","length","undefined","ShouldPass","useState","proposals","setProposals","voteDetail","setVoteDetail","voteDisabled","setVoteDisabled","accountAddress","useAppSelector","state","wallet","total","setTotal","navigate","useNavigate","useParams","id","handle","getDetailData","Promise","all","proposalsApi","prosposalRes","votesRes","find","vote","proposer","handleVote","type","parseInt","then","message","catch","useEffect","yes_votes","no_votes","abstained_votes","className","variant","sx","width","onClick","title","is_resolved","truncateMiddle","dangerouslySetInnerHTML","__html","description","dayjs","start_time","format","end_time","percentage","style","item","index","key","should_pass","disabled","text"],"sourceRoot":""}